{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Users\\\\mirta\\\\Desktop\\\\Projekt R-mobilna\\\\SpaceInvaders\\\\auth\\\\authContext.tsx\";\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport * as React from 'react';\nimport { useContext, createContext, useState, useEffect } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { AxiosInstance } from \"./AxiosInstance\";\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      authData = _useState2[0],\n      setAuthData = _useState2[1];\n\n  var _useState3 = useState(true),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      students = _useState6[0],\n      setStudents = _useState6[1];\n\n  var _useState7 = useState(''),\n      _useState8 = _slicedToArray(_useState7, 2),\n      studentId = _useState8[0],\n      setStudentId = _useState8[1];\n\n  var _useState9 = useState(''),\n      _useState10 = _slicedToArray(_useState9, 2),\n      image = _useState10[0],\n      setImage = _useState10[1];\n\n  useEffect(function () {\n    loadStorageData();\n  }, []);\n\n  var chooseName = function chooseName(id) {\n    console.log('id', id);\n    setStudentId(id);\n    console.log('object');\n  };\n\n  var chooseImage = function chooseImage(image) {\n    console.log(image);\n    setImage(image);\n  };\n\n  var loadStorageData = function loadStorageData() {\n    var authDataSerialized, _authData;\n\n    return _regeneratorRuntime.async(function loadStorageData$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem('@AuthData'));\n\n          case 3:\n            authDataSerialized = _context.sent;\n\n            if (authDataSerialized) {\n              _authData = JSON.parse(authDataSerialized);\n              setAuthData(_authData);\n            }\n\n            _context.next = 9;\n            break;\n\n          case 7:\n            _context.prev = 7;\n            _context.t0 = _context[\"catch\"](0);\n\n          case 9:\n            _context.prev = 9;\n            setLoading(false);\n            return _context.finish(9);\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 7, 9, 12]], Promise);\n  };\n\n  var signIn = function signIn() {\n    return _regeneratorRuntime.async(function signIn$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            console.log(studentId, image);\n            return _context2.abrupt(\"return\", AxiosInstance.post('/login', {\n              studentId: studentId,\n              pictureKey: image\n            }).then(function (res) {\n              var _authData = res.data;\n              console.log('data', res.data);\n              setStudents(res.data);\n              setAuthData(_authData);\n              AsyncStorage.setItem('@AuthData', JSON.stringify(_authData));\n              return _authData;\n            }).catch(function (error) {\n              return error.response;\n            }));\n\n          case 2:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var signOut = function signOut() {\n    return _regeneratorRuntime.async(function signOut$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            setAuthData(undefined);\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.removeItem('@AuthData'));\n\n          case 3:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return React.createElement(AuthContext.Provider, {\n    value: {\n      authData: authData,\n      loading: loading,\n      signIn: signIn,\n      signOut: signOut,\n      chooseName: chooseName,\n      chooseImage: chooseImage\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 5\n    }\n  }, children);\n};\nvar AuthContext = createContext({});\nexport var useAuth = function useAuth() {\n  return useContext(AuthContext);\n};\nexport { AuthContext };","map":{"version":3,"sources":["C:/Users/mirta/Desktop/Projekt R-mobilna/SpaceInvaders/auth/authContext.tsx"],"names":["React","useContext","createContext","useState","useEffect","AsyncStorage","AxiosInstance","AuthProvider","children","authData","setAuthData","loading","setLoading","students","setStudents","studentId","setStudentId","image","setImage","loadStorageData","chooseName","id","console","log","chooseImage","getItem","authDataSerialized","_authData","JSON","parse","signIn","post","pictureKey","then","res","data","setItem","stringify","catch","error","response","signOut","undefined","removeItem","AuthContext","useAuth"],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport { useContext, createContext, useState, useEffect } from 'react';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport { AxiosResponse } from 'axios';\r\nimport { AxiosInstance } from './AxiosInstance';\r\nimport { IStudent } from '../context/classContext';\r\n\r\ntype AuthContextData = {\r\n  authData?: AuthData;\r\n  loading: boolean;\r\n  signIn(): Promise<AxiosResponse>;\r\n  signOut(): void;\r\n  chooseName: (id: string) => void;\r\n  chooseImage: (picture: string) => void;\r\n};\r\n\r\nexport type AuthData = {\r\n  userId: string;\r\n  userImage: string;\r\n  token: string;\r\n};\r\n\r\n/*Warning: Can't perform a React state update on an unmounted component. This is a no-op, \r\nbut it indicates a memory leak in your application.\r\n To fix, cancel all subscriptions and asynchronous tasks in a useEffect cleanup function. */\r\nexport const AuthProvider: React.FC = ({ children }) => {\r\n  const [authData, setAuthData] = useState<AuthData>();\r\n  const [loading, setLoading] = useState(true);\r\n  const [students, setStudents] = useState<IStudent[]>([]);\r\n  const [studentId, setStudentId] = useState('');\r\n  const [image, setImage] = useState('');\r\n\r\n  useEffect(() => {\r\n    loadStorageData();\r\n  }, []);\r\n\r\n  const chooseName = (id: string) => {\r\n    console.log('id', id);\r\n    setStudentId(id);\r\n    console.log('object');\r\n  };\r\n\r\n  const chooseImage = (image: string) => {\r\n    console.log(image);\r\n    setImage(image);\r\n  };\r\n\r\n  const loadStorageData = async (): Promise<void> => {\r\n    try {\r\n      const authDataSerialized = await AsyncStorage.getItem('@AuthData');\r\n      if (authDataSerialized) {\r\n        const _authData: AuthData = JSON.parse(authDataSerialized);\r\n        setAuthData(_authData);\r\n      }\r\n    } catch (error) {\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const signIn = async () => {\r\n    console.log(studentId, image);\r\n    return AxiosInstance.post('/login', {\r\n      studentId: studentId,\r\n      pictureKey: image,\r\n    })\r\n      .then((res) => {\r\n        const { data: _authData } = res;\r\n        console.log('data', res.data);\r\n        setStudents(res.data);\r\n\r\n        setAuthData(_authData);\r\n        AsyncStorage.setItem('@AuthData', JSON.stringify(_authData));\r\n\r\n        return _authData;\r\n      })\r\n      .catch((error) => {\r\n        return error.response;\r\n      });\r\n  };\r\n\r\n  const signOut = async () => {\r\n    setAuthData(undefined);\r\n    await AsyncStorage.removeItem('@AuthData');\r\n  };\r\n  return (\r\n    <AuthContext.Provider value={{ authData, loading, signIn, signOut, chooseName, chooseImage }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\nconst AuthContext = createContext<AuthContextData>({} as AuthContextData);\r\n\r\n// Hook for using auth data\r\n/* export const useAuth = (): AuthContextData => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n\r\n  return context;\r\n}; */\r\nexport const useAuth = (): AuthContextData => useContext(AuthContext);\r\nexport { AuthContext };\r\n"]},"metadata":{},"sourceType":"module"}